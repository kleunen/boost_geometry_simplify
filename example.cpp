#include "simplify.hpp"

#include <iostream>
#include <chrono>

void benchmark(bool use_boost)
{
	// Benchmark overlapping approach
	MultiPolygon poly;
	boost::geometry::read_wkt("MULTIPOLYGON(((0.561648 1,1 1,1 0,0.468083 0,0.52758 0.00800554,0.599683 0.0280924,0.601611 0.265374,0.622693 0.316765,0.69507 0.357497,0.695623 0.429711,0.655111 0.502298,0.696467 0.543147,0.840712 0.593546,0.882583 0.66546,0.852357 0.748213,0.84264 0.789567,0.832667 0.841202,0.832667 0.841202,0.740538 0.873004,0.617349 0.905045,0.566576 0.977697,0.561648 1)),((0 0.801979,0.0308575 0.786234,0.0705513 0.631135,0.141616 0.527248,0.233985 0.505872,0.264777 0.526263,0.336631 0.505009,0.356603 0.422321,0.355803 0.350038,0.375252 0.205364,0.415206 0.0709182,0.45479 0,0 0,0 0,0 0.801979)))", poly);

  	auto const start = std::chrono::steady_clock::now();

	constexpr std::size_t count = 10000;
	for(std::size_t i = 0; i < count; ++i) {
		MultiPolygon result;
		if(use_boost)
	    	boost::geometry::simplify(poly, result, 1.0 / 2048);
		else
	    	simplify(poly, result, 1.0 / 2048);
	}

  	auto const end = std::chrono::steady_clock::now();
  	auto const ms = std::chrono::duration_cast<std::chrono::milliseconds>(end - start).count();
  	std::cout << (use_boost ? " time boost: " : " time self-intersection: ") << (double)ms / count << std::endl;
}

bool equals(Polygon const &a, Polygon const &b)
{
	if(a.outer().size() != b.outer().size()) return false;
	if(a.inners().size() != b.inners().size()) return false;

	for(std::size_t i = 0; i < a.inners().size(); ++i) {
		if(a.inners()[i].size() != b.inners()[i].size()) return false;
	}

	return (boost::geometry::area(a) - boost::geometry::area(b) < 0.00001);
}

bool equals(MultiPolygon const &a, MultiPolygon const &b)
{
	if(a.size() != b.size()) return false;

	for(std::size_t i = 0; i < a.size(); ++i) {
		if(!equals(a[i], b[i])) return false;
	}

	return (boost::geometry::area(a) - boost::geometry::area(b) < 0.00001);
}

void test(char const *wkt, double distance)
{
	MultiPolygon mp;
	boost::geometry::read_wkt(wkt, mp);

    // Simplify it using distance of 0.5 units
    MultiPolygon simplified;
    simplify(mp, simplified, distance);

    MultiPolygon boost_simplified;
    boost::geometry::simplify(mp, boost_simplified, distance);

	bool match = equals(simplified, boost_simplified);

	if(boost::geometry::area(simplified) != boost::geometry::area(boost_simplified)) std::cout << "Area does not match" << std::endl;

	std::string message;
	if(!boost::geometry::is_valid(boost_simplified, message)) {
		std::cout << "Boost simplify generated invalid geometry: " << message << std::endl;
	}

    std::cout << std::setprecision(12) << std::boolalpha 
        << "  original: " << boost::geometry::is_valid(mp) << " " << boost::geometry::wkt(mp) << "(" << boost::geometry::area(mp) << ")" << std::endl
        << "simplified: " << boost::geometry::is_valid(simplified) << " " << boost::geometry::wkt(simplified) << "(" << boost::geometry::area(simplified) << ")" << std::endl
        << "boost     : " << boost::geometry::is_valid(boost_simplified) << " " << boost::geometry::wkt(boost_simplified) << "(" << boost::geometry::area(boost_simplified) << ")" << std::endl
		<< "match     : " << match << std::endl << std::endl;

	//if(!match) throw std::runtime_error("TEST FAILED");
}

int main()
{
	test("MULTIPOLYGON(((4 0,8 2,8 7,4 9,0 7,0 2,2 1,4 0)))", 1.0);
	test("MULTIPOLYGON(((4 0,8 2,8 7,4 9,0 7,0 2,2 1,4 0),(7 3,7 6,1 6,1 3,4 3,7 3)))", 1.0);

	test("MULTIPOLYGON(((0.561648 1,1 1,1 0,0.468083 0,0.52758 0.00800554,0.599683 0.0280924,0.601611 0.265374,0.622693 0.316765,0.69507 0.357497,0.695623 0.429711,0.655111 0.502298,0.696467 0.543147,0.840712 0.593546,0.882583 0.66546,0.852357 0.748213,0.84264 0.789567,0.832667 0.841202,0.832667 0.841202,0.740538 0.873004,0.617349 0.905045,0.566576 0.977697,0.561648 1)))", 1.0 / 2048.0); 
	test("MULTIPOLYGON(((0 0.801979,0.0308575 0.786234,0.0705513 0.631135,0.141616 0.527248,0.233985 0.505872,0.264777 0.526263,0.336631 0.505009,0.356603 0.422321,0.355803 0.350038,0.375252 0.205364,0.415206 0.0709182,0.45479 0,0 0,0 0,0 0.801979)))", 1.0 / 2048.0); 
	test("MULTIPOLYGON(((0.561648 1,1 1,1 0,0.468083 0,0.52758 0.00800554,0.599683 0.0280924,0.601611 0.265374,0.622693 0.316765,0.69507 0.357497,0.695623 0.429711,0.655111 0.502298,0.696467 0.543147,0.840712 0.593546,0.882583 0.66546,0.852357 0.748213,0.84264 0.789567,0.832667 0.841202,0.832667 0.841202,0.740538 0.873004,0.617349 0.905045,0.566576 0.977697,0.561648 1)),((0 0.801979,0.0308575 0.786234,0.0705513 0.631135,0.141616 0.527248,0.233985 0.505872,0.264777 0.526263,0.336631 0.505009,0.356603 0.422321,0.355803 0.350038,0.375252 0.205364,0.415206 0.0709182,0.45479 0,0 0,0 0,0 0.801979)))", 1.0 / 2048.0); 
	test("MULTIPOLYGON(((1149.69 2047,2047 2047,2047 0,958.166 0,1079.96 16.3873,1227.55 57.5051,1231.5 543.221,1274.65 648.418,1422.81 731.796,1423.94 879.618,1341.01 1028.2,1425.67 1111.82,1720.94 1214.99,1806.65 1362.2,1744.77 1531.59,1724.88 1616.24,1704.47 1721.94,1704.47 1721.94,1515.88 1787.04,1263.71 1852.63,1159.78 2001.35,1149.69 2047)),((0 1641.65,63.1653 1609.42,144.419 1291.93,289.888 1079.28,478.967 1035.52,541.999 1077.26,689.084 1033.75,729.966 864.491,728.329 716.528,768.141 420.38,849.927 145.17,930.955 0,0 0,0 0,0 1641.65)))", 1.0);

	// Boost generates self-intersection
	test("MULTIPOLYGON(((-3.69338090482 55.715692269,-3.6926079 55.7159519,-3.6924337 55.7151986,-3.6930661 55.715117,-3.6930157 55.7147726,-3.69338091231 55.7147132692,-3.69338090482 55.715692269)),((-3.69338090688 55.7142211068,-3.6933768 55.7141871,-3.6929634 55.7141725,-3.6929954 55.7145025,-3.6923885 55.7145554,-3.6923617 55.7147792,-3.6914998 55.7150295,-3.6912315 55.7134982,-3.6893145 55.7140656,-3.6885759 55.7143373,-3.6878468 55.7144903,-3.6885649 55.7161566,-3.6879954 55.7164484,-3.6873303 55.7153805,-3.686997 55.7156142,-3.6864469 55.716,-3.686103 55.716241,-3.6862139 55.7163757,-3.6858363 55.7166538,-3.6853115 55.7167809,-3.6849156 55.7164513,-3.6845733 55.7165856,-3.6839978 55.7159007,-3.6839527 55.7158282,-3.6835296 55.7160357,-3.6808072 55.7170818,-3.6807411 55.7168675,-3.6805504 55.7150641,-3.682455 55.7150385,-3.6834742 55.7143695,-3.6845373 55.7140717,-3.6845125 55.7139033,-3.684369 55.7127279,-3.6806985 55.7123158,-3.6810755 55.7133089,-3.6813647 55.7139107,-3.681652 55.7137697,-3.6820175 55.7147227,-3.6805049 55.7147351,-3.6795311 55.7129405,-3.6778782 55.7129041,-3.6777658 55.714827,-3.6760112 55.7159293,-3.6752767 55.7124876,-3.6715262 55.7125441,-3.6712776 55.7122602,-3.6708886 55.711493,-3.6708159 55.7113861,-3.6706013 55.7110893,-3.670957 55.7111165,-3.6731425 55.7111427,-3.6742991 55.709201,-3.6753334 55.7095268,-3.6758595 55.710859,-3.6788138 55.7112687,-3.676502 55.7081632,-3.6780904 55.7067399,-3.6788205 55.7067314,-3.6792276 55.707739,-3.6793662 55.7086275,-3.6806176 55.7088675,-3.6804964 55.7104918,-3.6803571 55.7111529,-3.6809193 55.7114274,-3.6806673 55.7120776,-3.6843319 55.712513,-3.6853143 55.7126239,-3.6900574 55.7130953,-3.6914546 55.71325,-3.6915457 55.7128876,-3.6919092 55.712801,-3.6913866 55.7112063,-3.6933809 55.7105007,-3.69338090688 55.7142211068)),((-3.6933809 55.7105007,-3.6933589 55.7104093,-3.6925489 55.710479,-3.6924738 55.7097065,-3.6933482 55.7096368,-3.69338090149 55.7095931641,-3.6933809 55.7105007)),((-3.69338091082 55.7090016493,-3.692978 55.7091164,-3.692286 55.7091593,-3.6917755 55.7087839,-3.6906731 55.7089272,-3.6902922 55.7073596,-3.6908162 55.7071423,-3.6910434 55.7069466,-3.6912775 55.7066595,-3.6908162 55.7064289,-3.690583 55.7055368,-3.6920467 55.7047551,-3.6918633 55.7046247,-3.6926388 55.7037173,-3.69338090692 55.7037081763,-3.69338091082 55.7090016493)))", 0.0006);

	// Inner going outside the outer
	test("MULTIPOLYGON(((-2.36196828155 55.2004109127,-2.36073148473 55.2004109151,-2.3610594 55.2002713,-2.3604418 55.198792,-2.3598696 55.1990803,-2.3588339109 55.2004109053,-2.34760282989 55.2004108976,-2.3483219 55.1993147,-2.3502233 55.1967169,-2.3509745 55.1957384,-2.3512435 55.1953879,-2.3520915 55.1940966,-2.353186 55.1925031,-2.352622 55.1918678,-2.3522148 55.1906179,-2.3523376 55.1900833,-2.3526497 55.1894224,-2.3521319 55.1881285,-2.3511414 55.1871265,-2.3507091 55.1866928,-2.3471167 55.1842176,-2.3470084 55.1857687,-2.3452298 55.1892785,-2.3483112 55.193052,-2.348248 55.1932788,-2.3490238 55.1946284,-2.348069 55.1949931,-2.3459154 55.1966261,-2.3458191 55.1966995,-2.3440252 55.1952553,-2.3411146 55.19452,-2.3370516 55.2004109,-2.33172339577 55.2004109001,-2.3316204 55.199481,-2.3298093 55.1983924,-2.3412593 55.1825571,-2.3439735 55.1836689,-2.3442256 55.1826095,-2.3455482 55.1824917,-2.3459534 55.1824555,-2.3459231 55.1819098,-2.3566288 55.1814309,-2.3652902 55.1810396,-2.3671965 55.1815199,-2.3671157 55.1808239,-2.3668635 55.1788982,-2.36659 55.1764573,-2.3658605 55.1699989,-2.3657785 55.1679933,-2.3656431 55.1646935,-2.3654862 55.1646962,-2.338547 55.1653231,-2.3385409 55.1650695,-2.3376977 55.162904,-2.3368008 55.1635657,-2.3368346 55.1615553,-2.3375329 55.1598186,-2.3383705 55.1575695,-2.3383243 55.1573593,-2.3376614 55.1573796,-2.3348602 55.1576013,-2.3314727 55.1579828,-2.33019 55.1581557,-2.330279 55.1577688,-2.3304834 55.1572297,-2.3331396 55.1576567,-2.3334177 55.1568618,-2.3343383 55.1548774,-2.334882 55.1548915,-2.3346534 55.1555511,-2.3351568 55.1556946,-2.334874 55.1565054,-2.3350367 55.157042,-2.3354455 55.1572202,-2.3356638 55.1566964,-2.3361914 55.1568626,-2.3367762 55.1569067,-2.3367397 55.1572072,-2.3370839 55.1571407,-2.337575 55.1565906,-2.3379048 55.15656,-2.3380864 55.1559753,-2.338169 55.1547073,-2.3380868 55.1546577,-2.3348183 55.1546572,-2.3351552 55.1532097,-2.3354135 55.1532107,-2.336195 55.1532137,-2.3362339 55.152981,-2.3370261 55.1529894,-2.3370591 55.1528448,-2.3366276 55.1527978,-2.3366066 55.1525446,-2.3368715 55.1513569,-2.3359301 55.1511331,-2.3358406 55.1511118,-2.3363408 55.1490455,-2.3378753 55.1498596,-2.3381128 55.1493212,-2.3383759 55.1489264,-2.3385701 55.1487642,-2.3390069 55.1484863,-2.339367 55.149373,-2.3390102 55.1497189,-2.3390235 55.1501831,-2.3389857 55.1504675,-2.3389071 55.151334,-2.338221 55.1513998,-2.3383349 55.153222,-2.3399764 55.1532283,-2.3402203 55.1528534,-2.3451207 55.1504459,-2.3453111 55.1506295,-2.3456132 55.1507033,-2.3461407 55.150541,-2.3465283 55.1504714,-2.3469266 55.1502516,-2.3470513 55.1501714,-2.3472833 55.1501663,-2.3476426 55.1501377,-2.3481199 55.150093,-2.348538 55.1502828,-2.3489817 55.1506367,-2.3494342 55.1508805,-2.3498652 55.1509525,-2.3503088 55.1509357,-2.35052 55.1507947,-2.3507065 55.1505557,-2.3509614 55.1505711,-2.3511214 55.1502657,-2.3527394 55.1503199,-2.3539317 55.1503029,-2.3555155 55.1503449,-2.3563216 55.1504039,-2.3564099 55.1501253,-2.356277 55.1487558,-2.3568374 55.1486564,-2.3569926 55.1502489,-2.3568415 55.1504622,-2.3569823 55.1506559,-2.3572668 55.1513482,-2.3574968 55.1518388,-2.3590403 55.1515494,-2.3591245 55.1527209,-2.3588627 55.1528948,-2.3586783 55.1547843,-2.3584951 55.1559767,-2.3593382 55.1560536,-2.3592111 55.1589624,-2.3598755 55.1594068,-2.3611407 55.1593415,-2.3613214 55.1581168,-2.3609095 55.1569454,-2.3609216 55.1562716,-2.3598851 55.1560976,-2.3598245 55.1546652,-2.3604016 55.1545774,-2.3622171 55.1543599,-2.3620019 55.1531934,-2.3620471 55.1528211,-2.3626717 55.1527813,-2.3629554 55.1537319,-2.3639902 55.1535921,-2.3641506 55.1541387,-2.3638251 55.1541719,-2.3644161 55.1584245,-2.3650991 55.1576456,-2.3648126 55.1567634,-2.3652483 55.1564691,-2.3657764 55.1568245,-2.3661459 55.1563016,-2.3650181 55.1539575,-2.3649314 55.1536483,-2.3667517 55.1525694,-2.3671826 55.1529836,-2.3676203 55.1519895,-2.3679175 55.1520697,-2.3690504 55.1535334,-2.3696481 55.1534609,-2.3699049 55.1540163,-2.3663261 55.1564341,-2.36452 55.1585227,-2.3650204 55.1592038,-2.365791 55.1604173,-2.3659856 55.1608482,-2.3661365 55.1612069,-2.366186 55.1616084,-2.3662514 55.1617278,-2.3664701 55.1618204,-2.3669035 55.1619556,-2.3676751 55.1623389,-2.3684647 55.1629028,-2.3710792 55.16077,-2.3712474 55.1608318,-2.3718311 55.1621178,-2.3720285 55.1622213,-2.3740776 55.1610981,-2.3746787 55.1617071,-2.372312 55.1629353,-2.3723619 55.1630606,-2.3724557 55.1632489,-2.3726086 55.1634629,-2.3727307 55.1635527,-2.3733932 55.1638612,-2.3736162 55.1639604,-2.3752972 55.1624963,-2.3750667 55.1625211,-2.3754103 55.1619139,-2.3756135 55.161639,-2.3758166 55.1614018,-2.3760674 55.1611259,-2.3770523 55.1615343,-2.3781085 55.1615719,-2.3788062 55.1615967,-2.3794587 55.1873791,-2.3794148 55.1902412,-2.3783715 55.191558,-2.3776234 55.1909778,-2.3759272 55.1902518,-2.3759815 55.1903601,-2.3760125 55.1908785,-2.3760722 55.1918757,-2.3764968 55.1930128,-2.373263 55.1941032,-2.3719764 55.193464,-2.3709475 55.1941512,-2.3703452 55.1930247,-2.3719855 55.1921216,-2.37138 55.1897684,-2.3711523 55.1901166,-2.3701234 55.1908039,-2.3688173 55.1913285,-2.3675219 55.1920317,-2.3668448 55.1941308,-2.3669619 55.196091,-2.3670018 55.1961075,-2.3669461 55.1962241,-2.3673031 55.1977231,-2.3647103 55.1989655,-2.3641674 55.1981417,-2.3636675 55.1983979,-2.362898 55.1987926,-2.3628104 55.1997375,-2.362304 55.2002174,-2.36196828155 55.2004109127),(-2.3749133 55.1686658,-2.3753804 55.1678403,-2.3756809 55.1667178,-2.3757078 55.1656034,-2.3749454 55.1655164,-2.374835 55.1668939,-2.3747916 55.1670777,-2.3743831 55.1670594,-2.3743259 55.1662793,-2.3743778 55.1652241,-2.3749402 55.1652569,-2.3751302 55.1651099,-2.3750627 55.1645765,-2.3748828 55.1643295,-2.3747273 55.1645777,-2.3743048 55.1650646,-2.3739113 55.165521,-2.3737642 55.1650268,-2.3718458 55.1651631,-2.3712023 55.1652358,-2.3698416 55.1664226,-2.3694849 55.1665692,-2.3678795 55.1673675,-2.3687569 55.1694262,-2.3693067 55.1698642,-2.3695066 55.1696701,-2.3699176 55.1699835,-2.3701231 55.1697486,-2.3707229 55.1705329,-2.3716376 55.1703628,-2.3722371 55.1705567,-2.3725389 55.1702651,-2.3727609 55.1697176,-2.3730865 55.1699482,-2.3737286 55.1692291,-2.3734117 55.1689274,-2.3737763 55.1683446,-2.3749133 55.1686658),(-2.3602617 55.1828264,-2.3603047 55.1828372,-2.3603744 55.1827299,-2.360589 55.1826547,-2.3608518 55.1825367,-2.3610235 55.1824294,-2.3613346 55.1822792,-2.3615868 55.1821773,-2.3617799 55.1820754,-2.3618067 55.1819789,-2.361711 55.1818438,-2.3616887 55.1818124,-2.3614634 55.1818178,-2.3613668 55.1817053,-2.3612488 55.1815657,-2.36112 55.1814638,-2.3608626 55.1814263,-2.3605729 55.1814209,-2.3602939 55.181378,-2.3600418 55.1813459,-2.3598272 55.1813296,-2.3594249 55.1813565,-2.3592908 55.1814424,-2.3596239 55.1819172,-2.3602617 55.1828264)))", 0.0006);

	// Overlapping inners
	test("MULTIPOLYGON(((-2.19834390634 55.4826573962,-2.19805 55.4827838,-2.1975402 55.4832772,-2.1974427 55.4834622,-2.1976143 55.4840845,-2.1974748 55.4841488,-2.1972227 55.4836124,-2.197094 55.4837411,-2.1969491 55.4838054,-2.1966595 55.4838109,-2.1963644 55.4835427,-2.1966434 55.48343,-2.1966434 55.4832315,-2.1966863 55.4830061,-2.1969008 55.4830545,-2.1970673 55.4827253,-2.1971315 55.4825984,-2.1972853 55.4826809,-2.1977125 55.4820134,-2.1979508 55.4820823,-2.1982259 55.482003,-2.19834390533 55.4819210713,-2.19834390634 55.4826573962)),((-2.1983439 55.4816651,-2.197514 55.4810913,-2.1973005 55.4811689,-2.1971852 55.4813083,-2.1969706 55.481413,-2.1965522 55.4817582,-2.1963 55.481716,-2.1961686 55.4817537,-2.1961096 55.4817026,-2.1961901 55.4815712,-2.196233 55.4814317,-2.1963805 55.4815149,-2.1964663 55.4812547,-2.1964851 55.4808685,-2.1969062 55.4809731,-2.1969223 55.4809249,-2.1968365 55.4796641,-2.1976572 55.4798519,-2.1980649 55.4803025,-2.19834390232 55.4803153531,-2.1983439 55.4816651),(-2.198189 55.4807385,-2.1982078 55.4806797,-2.197614 55.480153,-2.1975477 55.4801595,-2.1972644 55.4804381,-2.1972707 55.4805154,-2.1976504 55.4808542,-2.1977426 55.48088,-2.198189 55.4807385)),((-2.19834390403 55.4743474429,-2.1982366 55.4740691,-2.1977055 55.4739833,-2.1974963 55.4736829,-2.1975445 55.4732791,-2.1975875 55.4729747,-2.1970189 55.4724382,-2.1967828 55.4722828,-2.1965575 55.4722291,-2.1962776 55.4723038,-2.1954622 55.4725399,-2.1949482 55.4725134,-2.1946361 55.4726579,-2.1939804 55.4727034,-2.1938636 55.4728188,-2.1936561 55.4726943,-2.1936214 55.4723983,-2.193599 55.4721646,-2.1935132 55.4722291,-2.1934006 55.4724061,-2.192899 55.4721808,-2.1924277 55.4721693,-2.1922763 55.4722062,-2.1921694 55.472846,-2.1922258 55.4732162,-2.1923706 55.4735702,-2.1925969 55.4736687,-2.1926415 55.4739699,-2.1924725 55.4742434,-2.1920027 55.4740188,-2.1920192 55.4734307,-2.1917242 55.4734254,-2.1910965 55.473656,-2.1911431 55.4731633,-2.1912015 55.4727234,-2.1911019 55.4726072,-2.1909142 55.472567,-2.1906781 55.4723793,-2.1903858 55.4722612,-2.1902865 55.4723121,-2.1895355 55.4714834,-2.1894665 55.4713775,-2.1893944 55.4712668,-2.1891975 55.4710972,-2.1890205 55.4710515,-2.1889215 55.4706419,-2.1882464 55.4707301,-2.1881246 55.4707512,-2.1880279 55.4707081,-2.1879745 55.4706841,-2.1877223 55.4705687,-2.187438 55.4705553,-2.187143 55.4705903,-2.1867272 55.470778,-2.1864858 55.4709845,-2.1860781 55.4714083,-2.185708 55.4717302,-2.1853834 55.471969,-2.185016 55.47239,-2.1847665 55.4729049,-2.184391 55.4728138,-2.1845359 55.4725214,-2.1847075 55.4719635,-2.1847388 55.4719194,-2.1848819 55.4718429,-2.185311 55.4716041,-2.1854286 55.4715273,-2.1855497 55.4714432,-2.1856577 55.4713171,-2.1857995 55.4710336,-2.1860026 55.4706249,-2.1861184 55.4704481,-2.1863481 55.4702057,-2.1866307 55.4698607,-2.1868399 55.4695495,-2.1868779 55.4693741,-2.1868944 55.469216,-2.1869159 55.4690462,-2.1869767 55.468769,-2.1869069 55.4685007,-2.1876886 55.4681868,-2.187548 55.4679429,-2.1876859 55.4678895,-2.1877143 55.4678785,-2.1878806 55.4681172,-2.1881756 55.468364,-2.188476 55.4686027,-2.188637 55.4687904,-2.1887577 55.4689433,-2.1889052 55.4691016,-2.1890903 55.4692304,-2.1892431 55.4692786,-2.1894175 55.4693027,-2.1896052 55.469292,-2.1895784 55.4691339,-2.1896643 55.4689728,-2.1896357 55.4687485,-2.1895731 55.4682917,-2.1895784 55.4680824,-2.1896428 55.4677873,-2.1898078 55.4670649,-2.1899217 55.4665911,-2.1899003 55.4663442,-2.1898595 55.4660861,-2.189793 55.4658615,-2.189637 55.4651515,-2.1896267 55.464778,-2.1900713 55.4651112,-2.1902114 55.4654377,-2.1902812 55.4656684,-2.1903402 55.465883,-2.1904582 55.4661566,-2.1904904 55.4665643,-2.1903383 55.4666155,-2.1904121 55.4674344,-2.1904475 55.4679966,-2.1904475 55.4684794,-2.1918529 55.4682004,-2.1918958 55.4686241,-2.1903682 55.4688969,-2.1903294 55.4691016,-2.1904367 55.4693109,-2.1905735 55.469512,-2.1906728 55.4695415,-2.1907774 55.4695495,-2.1910669 55.4695168,-2.1916187 55.4694407,-2.1919723 55.4693741,-2.1921201 55.4693461,-2.1925971 55.4692562,-2.1929151 55.4690694,-2.1930894 55.4689863,-2.1932933 55.4688199,-2.1931102 55.468642,-2.1934216 55.4682692,-2.1932657 55.4676454,-2.1938914 55.4672402,-2.1940094 55.4675888,-2.1943259 55.4678054,-2.1943367 55.4674654,-2.1941543 55.4672348,-2.194084 55.4671188,-2.1938431 55.466752,-2.1934837 55.4663122,-2.1932992 55.4657104,-2.193833 55.4655869,-2.1942776 55.4653894,-2.19446 55.4650944,-2.1946585 55.4644613,-2.1947014 55.4641288,-2.1949107 55.464043,-2.1951306 55.4634315,-2.1953881 55.4625999,-2.1958441 55.4621278,-2.1958167 55.461689,-2.1962196 55.4621789,-2.1959353 55.4625301,-2.195549 55.4628897,-2.1954095 55.4636594,-2.1953934 55.4641128,-2.1948463 55.4645097,-2.1946827 55.4652794,-2.1946371 55.4658212,-2.1946666 55.4663712,-2.1946317 55.4671623,-2.1951509 55.4675058,-2.1951976 55.4677283,-2.1953828 55.467667,-2.195785 55.4672804,-2.1962129 55.466938,-2.1962795 55.4665878,-2.197151 55.4661433,-2.1960215 55.4651812,-2.1961491 55.4649616,-2.1966835 55.4651699,-2.1971959 55.4642307,-2.1972013 55.464043,-2.1973005 55.463917,-2.1971986 55.4636219,-2.1972978 55.4635172,-2.1972603 55.4633027,-2.1971396 55.4632839,-2.1969759 55.4634072,-2.1968606 55.4635065,-2.1967922 55.4634422,-2.1969438 55.4632812,-2.1971168 55.4631176,-2.1972871 55.4631873,-2.1974614 55.4632034,-2.1975151 55.4634154,-2.1975343 55.4637043,-2.1978825 55.4641637,-2.1983251 55.4645794,-2.19834390672 55.4645930122,-2.19834390504 55.4657016377,-2.1978891 55.4657108,-2.1973365 55.4659657,-2.1972453 55.4663197,-2.1969601 55.4666669,-2.1966685 55.4668694,-2.1966647 55.4670114,-2.196771 55.4670238,-2.1969282 55.4669552,-2.197058 55.4667287,-2.1973529 55.4666756,-2.1976366 55.4665675,-2.1979122 55.4662879,-2.1980945 55.4659943,-2.19834390474 55.4660055145,-2.19834390403 55.4743474429),(-2.1879181 55.4704185,-2.1879382 55.4703488,-2.1879047 55.4701638,-2.1878417 55.4699452,-2.1877947 55.4699062,-2.1875748 55.4700162,-2.1874608 55.4700659,-2.1874139 55.4700645,-2.1873388 55.4700296,-2.1872207 55.4697964,-2.1871215 55.469622,-2.1870598 55.4695817,-2.1869887 55.4696152,-2.1868265 55.4697801,-2.1867541 55.4698875,-2.186746 55.4699384,-2.186805 55.4700216,-2.1869686 55.4702067,-2.1871322 55.4703649,-2.1872154 55.4703917,-2.1876258 55.4704051,-2.1878752 55.4704347,-2.1879181 55.4704185),(-2.1877679 55.4698151,-2.1874112 55.4692277,-2.1873254 55.4692625,-2.187151 55.4695174,-2.18743 55.4699841,-2.1877679 55.4698151),(-2.1897528 55.47147,-2.1893933 55.4704428,-2.1892592 55.4705044,-2.1895972 55.4714754,-2.1897528 55.47147)))", 0.0003);

	test("MULTIPOLYGON(((-2.7606701 55.2826032,-2.7616722 55.2838254,-2.76061 55.2847266,-2.7616024 55.2862393,-2.7618656 55.2863365,-2.7613825 55.2871942,-2.7611625 55.2873015,-2.7610284 55.2877735,-2.7608407 55.2888251,-2.760787 55.2890879,-2.7605885 55.2891092,-2.7601326 55.2894097,-2.7599502 55.289517,-2.7602989 55.2900696,-2.7598429 55.2906865,-2.7598697 55.2908688,-2.7605349 55.2915018,-2.7614951 55.2919685,-2.7613396 55.2928913,-2.7615702 55.2929771,-2.7613342 55.2937227,-2.7625948 55.2940714,-2.7630293 55.2934438,-2.7632386 55.2928752,-2.7634558 55.2923789,-2.7646574 55.2907937,-2.7643973 55.2901982,-2.7636677 55.2900481,-2.7635229 55.2905201,-2.763319 55.2905899,-2.7633083 55.2901124,-2.7630776 55.2900748,-2.763028 55.2903216,-2.7627973 55.2903874,-2.7622998 55.2896994,-2.7629381 55.289061,-2.76348 55.2887821,-2.7642149 55.288723,-2.7646118 55.2888411,-2.7641881 55.2890932,-2.7637267 55.2891468,-2.7635551 55.2893078,-2.7637106 55.2894257,-2.7639788 55.2892326,-2.7645367 55.2890503,-2.7648747 55.2888733,-2.7650571 55.2889591,-2.7660066 55.2888303,-2.7673262 55.288428,-2.7718404 55.2863278,-2.7718565 55.2867061,-2.7727148 55.2867061,-2.7735838 55.2870977,-2.7741417 55.2872666,-2.7742919 55.2872612,-2.7743509 55.2874088,-2.7743161 55.2874919,-2.7742597 55.2876019,-2.7743617 55.2878353,-2.7743402 55.287972,-2.7740318 55.2880042,-2.7738065 55.2880524,-2.7737823 55.2881464,-2.7739969 55.288361,-2.7745575 55.2886854,-2.7747774 55.2891441,-2.7747104 55.2894794,-2.7747721 55.2897397,-2.7752173 55.2904853,-2.775507 55.290555,-2.7760729 55.290826,-2.7766067 55.2910807,-2.7771968 55.2908688,-2.7775294 55.2907991,-2.7779424 55.2908527,-2.7782643 55.2909331,-2.7786559 55.2909868,-2.7788758 55.2915286,-2.779187 55.2918827,-2.7796054 55.2915876,-2.7804476 55.2911692,-2.7806421 55.2910619,-2.7808593 55.2908527,-2.7809651 55.2906444,-2.7809893 55.2907577,-2.7809979 55.2908843,-2.7809706 55.290915,-2.7810985 55.2908814,-2.7812321 55.2908094,-2.7813989 55.2907659,-2.7815114 55.2906178,-2.7818295 55.2905319,-2.7824763 55.2902973,-2.7827755 55.2901662,-2.7830356 55.290131,-2.7831005 55.2901727,-2.7832538 55.2903626,-2.7834598 55.290843,-2.7836451 55.2911539,-2.7836896 55.2912286,-2.7838247 55.2917654,-2.7838656 55.2919284,-2.7837992 55.2920728,-2.7836667 55.2921603,-2.7835304 55.292403,-2.7831562 55.2927723,-2.7829538 55.292958,-2.7828613 55.2931665,-2.782952 55.2933456,-2.7831679 55.2935463,-2.7833296 55.2936426,-2.7835671 55.2937178,-2.7836201 55.2938067,-2.7835536 55.2939512,-2.7833712 55.2941975,-2.7830724 55.294747,-2.7829703 55.2950336,-2.7829488 55.2951592,-2.7827492 55.2955705,-2.7828509 55.2957747,-2.7829027 55.2960377,-2.7829452 55.2964732,-2.7828991 55.2968234,-2.7826445 55.2970658,-2.7840474 55.2983402,-2.7830122 55.2995369,-2.7833863 55.2999643,-2.7820879 55.3009097,-2.7825531 55.3013348,-2.7828482 55.3017345,-2.7830011 55.3020483,-2.783285 55.3028465,-2.783398 55.3030139,-2.7837387 55.3034082,-2.7837521 55.3035368,-2.7836823 55.3037005,-2.783795 55.3038131,-2.7848336 55.304145,-2.7852756 55.3043201,-2.7855894 55.3043147,-2.7863061 55.3041716,-2.7864809 55.3042624,-2.7864538 55.3055368,-2.7864247 55.3056232,-2.786445 55.3059804,-2.7868795 55.3061306,-2.7870753 55.3061486,-2.7874686 55.3074887,-2.7873148 55.3075851,-2.7844931 55.3071225,-2.7840066 55.3081832,-2.7839424 55.3085229,-2.783673 55.3088467,-2.7830603 55.3089962,-2.7821138 55.3094347,-2.7802701 55.3101511,-2.7801071 55.3103084,-2.7799988 55.310269,-2.7799017 55.310437,-2.779711 55.3107437,-2.7795862 55.3106314,-2.779684 55.3096851,-2.7791318 55.3095113,-2.7789255 55.3094138,-2.7785689 55.3093832,-2.7780765 55.3090068,-2.7772777 55.3086212,-2.7769765 55.3083129,-2.776724 55.3081159,-2.7766139 55.307886,-2.7761228 55.3080637,-2.7755723 55.3076094,-2.7742571 55.3081503,-2.7737221 55.3086922,-2.766377 55.3080699,-2.766645 55.3069701,-2.7657089 55.3066483,-2.7653521 55.3065597,-2.7637804 55.3070935,-2.7635657 55.3078317,-2.7589057 55.3074369,-2.7584535 55.3092473,-2.7578741 55.3087967,-2.7568764 55.3083353,-2.7557606 55.3081222,-2.7557311 55.307347,-2.7558263 55.3072384,-2.7559671 55.3072249,-2.7562313 55.3070278,-2.7558357 55.3064041,-2.75612 55.3063908,-2.7568093 55.3061923,-2.7565867 55.3052348,-2.7559912 55.3053742,-2.7558142 55.3049773,-2.7562648 55.3045319,-2.7555621 55.3036736,-2.7554494 55.303561,-2.7548647 55.3040278,-2.7543336 55.3039474,-2.7543417 55.3042946,-2.7535397 55.3042959,-2.7533908 55.3040332,-2.7535611 55.3025687,-2.7542639 55.3013456,-2.7550203 55.2991461,-2.7550827 55.2986981,-2.7518606 55.2981591,-2.7520001 55.2965926,-2.7523434 55.2942109,-2.7525955 55.2934384,-2.7527833 55.2915501,-2.7526672 55.2911913,-2.7522093 55.2907884,-2.7520001 55.290488,-2.7520001 55.2902788,-2.7521342 55.2900588,-2.7524829 55.289914,-2.7527458 55.2898228,-2.7532017 55.2904558,-2.7537704 55.2902143,-2.7534592 55.2893508,-2.7533734 55.2889484,-2.7533412 55.2887123,-2.7536631 55.2881973,-2.7539152 55.2880096,-2.7546984 55.287795,-2.7556157 55.2875965,-2.7565062 55.2874357,-2.7571553 55.2871727,-2.7571633 55.2869582,-2.7573672 55.2861992,-2.7579385 55.2846783,-2.7589417 55.2852443,-2.7593145 55.284622,-2.7583087 55.2839809,-2.7591401 55.2828436,-2.7594674 55.2831494,-2.7597114 55.2836108,-2.7599716 55.2832889,-2.7606701 55.2826032),(-2.7637777 55.2990121,-2.763893 55.3000017,-2.7634719 55.2999482,-2.7629247 55.2997469,-2.7627075 55.2997229,-2.7625385 55.3003424,-2.7631179 55.3004926,-2.7633753 55.3010934,-2.7638018 55.3009486,-2.7642176 55.301772,-2.7645984 55.303054,-2.7648103 55.3036039,-2.7646038 55.3036254,-2.764357 55.3028636,-2.7638313 55.3029388,-2.7637669 55.3038561,-2.7648935 55.3037327,-2.7652153 55.3036415,-2.7651805 55.3038427,-2.7669024 55.3037864,-2.7669588 55.3033009,-2.7672592 55.3032929,-2.7675623 55.3034028,-2.767691 55.3035423,-2.7674523 55.3048431,-2.7673289 55.3052267,-2.7670285 55.3056425,-2.7668005 55.3060019,-2.7666932 55.306321,-2.7668864 55.3064417,-2.7678895 55.3066886,-2.7682489 55.3056801,-2.7686727 55.3057926,-2.7690697 55.3036845,-2.7679056 55.3034161,-2.7679592 55.3031695,-2.7689302 55.3024292,-2.7666879 55.3019544,-2.7667227 55.3017157,-2.766484 55.3016083,-2.7657491 55.3016728,-2.7656257 55.3011095,-2.7652234 55.3004068,-2.7661867 55.2997943,-2.7667985 55.2996001,-2.7675465 55.2997735,-2.7694419 55.3010926,-2.7696919 55.3013405,-2.7698254 55.3013782,-2.7698946 55.3013785,-2.7701298 55.3009984,-2.7702528 55.3010163,-2.7703559 55.3009219,-2.7704597 55.3010048,-2.7705049 55.3011147,-2.7704819 55.3012205,-2.7703677 55.3015813,-2.7702642 55.3016365,-2.7701536 55.3017791,-2.7701819 55.3019892,-2.7712128 55.3022312,-2.772157 55.3030324,-2.7715238 55.3042714,-2.7727743 55.3040422,-2.7732627 55.3038539,-2.7736532 55.3037742,-2.7738469 55.3035986,-2.7738667 55.3034354,-2.7738272 55.3031053,-2.7736696 55.3028946,-2.7734591 55.3029158,-2.7732231 55.3029312,-2.7730864 55.3026698,-2.7729096 55.3021845,-2.7727983 55.3020534,-2.7726542 55.3019106,-2.772323 55.3018164,-2.7719597 55.3015772,-2.7713161 55.301432,-2.7711861 55.301464,-2.7712257 55.3015551,-2.7712022 55.3015921,-2.7711492 55.3016077,-2.7710431 55.3015853,-2.7708874 55.3015484,-2.770804 55.3014906,-2.7708353 55.3014233,-2.7705371 55.3007367,-2.7706284 55.300644,-2.770505 55.3004413,-2.7706439 55.3003772,-2.7708023 55.3002982,-2.7708897 55.3002363,-2.7710179 55.3003134,-2.771094 55.3003025,-2.7711542 55.3002598,-2.7713052 55.3000293,-2.7713141 55.2998741,-2.7714955 55.299909,-2.7714951 55.2998434,-2.7713658 55.2997535,-2.7712172 55.299699,-2.7709713 55.3000432,-2.7708731 55.3001549,-2.7707206 55.3002371,-2.7706152 55.3002389,-2.7705322 55.3002196,-2.7703943 55.3002025,-2.7702436 55.30017,-2.7700855 55.300078,-2.7692257 55.2991361,-2.7683848 55.2985639,-2.7678555 55.2984229,-2.7675694 55.298449,-2.7674549 55.2983142,-2.7675979 55.2981552,-2.767977 55.2978621,-2.7684991 55.297571,-2.7689629 55.2974615,-2.7689547 55.2972235,-2.7684876 55.2971763,-2.7683152 55.2969425,-2.7678845 55.296357,-2.7659142 55.29765,-2.76551 55.2983034,-2.7652749 55.2987,-2.7639772 55.2989199,-2.7639455 55.2982599,-2.7633968 55.2979664,-2.7631171 55.2969803,-2.7623428 55.2965648,-2.7615727 55.2965874,-2.7619398 55.2955801,-2.7617308 55.2954332,-2.7613931 55.2961662,-2.7608796 55.295859,-2.7607368 55.2948771,-2.7606521 55.2948307,-2.7603717 55.2951947,-2.7602506 55.295483,-2.7601854 55.2955968,-2.7602731 55.2956997,-2.7602633 55.295815,-2.7604005 55.295902,-2.7604329 55.2959737,-2.7603821 55.2960633,-2.7603245 55.2960959,-2.7601703 55.2960159,-2.7600863 55.2959058,-2.7600095 55.2958174,-2.7599058 55.2958055,-2.7597541 55.2959351,-2.7594936 55.2957436,-2.7591258 55.295595,-2.7592408 55.2953603,-2.7592503 55.2950447,-2.7592799 55.2944993,-2.7594923 55.2940415,-2.7596773 55.2939029,-2.7598174 55.2936384,-2.7595441 55.2932406,-2.7594021 55.2936345,-2.7592279 55.2939639,-2.7588708 55.2945259,-2.7584168 55.2946222,-2.7581022 55.2945953,-2.7566778 55.2943104,-2.7558428 55.2938273,-2.7559301 55.2946845,-2.7554918 55.2953485,-2.7554434 55.2962473,-2.7549814 55.2975586,-2.7554683 55.2977034,-2.7555025 55.2972514,-2.7556977 55.2970676,-2.7560021 55.2965498,-2.7564086 55.2956715,-2.7584132 55.2961775,-2.7585192 55.2963471,-2.7581907 55.2969887,-2.7586533 55.2968467,-2.7590623 55.2965115,-2.7602129 55.2970858,-2.7602568 55.297391,-2.7591943 55.2984239,-2.7586541 55.2994531,-2.7593344 55.299882,-2.759371 55.2993668,-2.7595944 55.2989372,-2.7608528 55.2976694,-2.7614447 55.2971904,-2.7620491 55.2973694,-2.7624657 55.2978597,-2.7634754 55.2987962,-2.7637777 55.2990121),(-2.7723259 55.2987572,-2.7716768 55.2993151,-2.7714193 55.2995511,-2.7716392 55.2997684,-2.7714971 55.3002485,-2.7717117 55.300278,-2.7718833 55.2995726,-2.7720684 55.2997577,-2.7720737 55.2998918,-2.772401 55.2999455,-2.7722186 55.300431,-2.7723071 55.3005463,-2.7730367 55.3007018,-2.7731574 55.3002807,-2.7730849 55.3001144,-2.7733156 55.2995886,-2.7730474 55.2993232,-2.7728784 55.2995028,-2.7727497 55.2994707,-2.7725834 55.2993312,-2.7726665 55.2992883,-2.7727041 55.2991649,-2.7724332 55.2986552,-2.7723259 55.2987572),(-2.7717224 55.2972284,-2.7718055 55.29718,-2.7717143 55.2970405,-2.7713764 55.2965041,-2.7706119 55.2970378,-2.7703545 55.2966918,-2.7701291 55.2969065,-2.770679 55.2974671,-2.7705047 55.2976467,-2.7705422 55.2977273,-2.7694237 55.298835,-2.7695471 55.2989664,-2.7708346 55.2977488,-2.7709687 55.2977058,-2.7710813 55.2977889,-2.7717224 55.2972284),(-2.7752602 55.3048217,-2.7755258 55.3048297,-2.7760541 55.3047439,-2.7765048 55.3045991,-2.7767998 55.3045213,-2.7764457 55.3041055,-2.7761373 55.3035396,-2.7759254 55.3033545,-2.7759013 55.302794,-2.7754882 55.3028047,-2.7755311 55.3031935,-2.7748552 55.3032338,-2.7749088 55.304406,-2.7752468 55.304406,-2.7752602 55.3048217),(-2.7835456 55.3047573,-2.7837843 55.3039447,-2.7836475 55.3037595,-2.7829903 55.3039017,-2.7829233 55.3041779,-2.782875 55.3044971,-2.7829501 55.3048753,-2.7835456 55.3047573),(-2.7769446 55.2923172,-2.7771297 55.2927892,-2.7779263 55.2926767,-2.7779853 55.2927303,-2.7781248 55.2933029,-2.7781141 55.293425,-2.7780417 55.2938085,-2.7779639 55.2939158,-2.7783099 55.2944094,-2.7789295 55.2940633,-2.7786022 55.2934465,-2.7789107 55.293264,-2.7788329 55.2931327,-2.7794901 55.2924406,-2.7791119 55.2919444,-2.7781402 55.2924936,-2.7780712 55.2918666,-2.7774221 55.2920221,-2.7769446 55.2923172),(-2.7780417 55.2966866,-2.7781141 55.2970647,-2.7782267 55.2972525,-2.7793452 55.2963755,-2.77971 55.2959274,-2.7791789 55.2951068,-2.7786478 55.2954098,-2.7781034 55.2950799,-2.777473 55.2954125,-2.7775911 55.2956351,-2.7777064 55.2959274,-2.7780417 55.2966866)))", 0.0003);

	benchmark(true);   
	benchmark(false);   
	return 0;
}
